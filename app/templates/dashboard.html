{% extends 'base.html' %}

{% block head %}
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='/dashboard/style.css') }}">
{% endblock %}

{% block content %}
<!-- Sidebar -->
<div class="sidebar collapsed" id="sidebar">
  <h2>Dashboard</h2>
  <a href="#">ğŸ  Home</a>
  <a href="/booking">ğŸ“Š Booking</a>
  <a href="#">ğŸ“ Projects</a>
  <a href="#">ğŸ§‘â€ğŸ’¼ Team</a>
  <a href="#">âš™ï¸ Settings</a>
  <a href="#">ğŸšª Logout</a>
</div>

<!-- Main Content -->
<div class="main-content">

  <!-- Upload Banner -->
  <div class="dashboard-banner-wrapper">
    <label class="upload-banner" id="drop-area">
      <div class="upload-message" id="uploadMessage">
        <div class="upload-icon">ğŸ–¼ï¸</div>
        <div class="upload-text">Click or drag to upload banner</div>
        <div class="upload-info">JPG, PNG, GIF â€” Max 5MB</div>
      </div>
      <input type="file" id="fileElem" accept="image/*">
      <div id="errorMsg" class="error"></div>
    </label>
  </div>

  <!-- Inner Dashboard Content -->
  <div class="dashboard-inner">
    <h2>Welcome back!</h2>
    <p style="color: var(--muted); margin-bottom: 20px;">
      Here's your schedule for <strong>{{ abbreviated_day_name }}</strong>:
    </p>

    <!-- Schedule Cards -->
    <div class="schedule-container">
      {% for schedule_slot in schedule %}
      <div class="schedule-card">
        <div class="card-item">{{ schedule_slot.start }} â€“ {{ schedule_slot.end }}</div>
        <div class="card-item course">{{ schedule_slot.course_code }}</div>
      </div>
      {% else %}
      <div class="schedule-card">
        <div class="card-item">No classes scheduled today.</div>
      </div>
      {% endfor %}
    </div>
  </div>

</div>

<!-- Scripts -->
<script>
  // Image Upload Preview
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('fileElem');
  const uploadMessage = document.getElementById('uploadMessage');
  const errorMsg = document.getElementById('errorMsg');
  let currentPreview = null;
  const MAX_SIZE_MB = 5;

  dropArea.addEventListener('click', () => fileInput.click());
  fileInput.addEventListener('change', handleFiles);

  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, (e) => {
      e.preventDefault();
      dropArea.classList.add('dragover');
    });
  });

  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, (e) => {
      e.preventDefault();
      dropArea.classList.remove('dragover');
    });
  });

  dropArea.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    handleFiles({ target: { files } });
  });

  function handleFiles(event) {
    const file = event.target.files[0];
    if (!file) return;

    errorMsg.textContent = '';
    const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
    if (!validTypes.includes(file.type)) {
      errorMsg.textContent = 'Unsupported file type.';
      return;
    }

    if (file.size > MAX_SIZE_MB * 1024 * 1024) {
      errorMsg.textContent = 'File too large. Max size is 5MB.';
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      if (currentPreview) currentPreview.remove();
      uploadMessage.style.display = 'none';

      const img = document.createElement('img');
      img.src = e.target.result;
      img.className = 'preview-img';
      dropArea.appendChild(img);
      currentPreview = img;
    };
    reader.readAsDataURL(file);
  }

  // Sidebar hover expand/collapse
  const sidebar = document.getElementById('sidebar');

  sidebar.addEventListener('mouseenter', () => {
    sidebar.classList.remove('collapsed');
  });

  sidebar.addEventListener('mouseleave', () => {
    sidebar.classList.add('collapsed');
  });
</script>
{% endblock %}
